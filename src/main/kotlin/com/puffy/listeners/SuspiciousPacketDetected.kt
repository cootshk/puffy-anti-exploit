package com.puffy.listeners

import com.puffy.MetricPacket
import com.puffy.SuspiciousPacketIdentifiedListener
import com.puffy.metrics.PlayerMetricType
import net.minecraft.server.network.ServerPlayerEntity
import net.minecraft.text.Text
import net.minecraft.util.Formatting

class SuspiciousPacketDetected : SuspiciousPacketIdentifiedListener {
    override fun onSuspiciousPacketIdentified(packet: MetricPacket, metric: PlayerMetricType, player: ServerPlayerEntity) {
        player.networkHandler.disconnect(buildDisconnectionMessage(packet, metric, player))
    }

    private fun buildDisconnectionMessage(packet: MetricPacket, metric: PlayerMetricType, player: ServerPlayerEntity): Text {
        val headerStart = Text.literal("[PAE.").formatted(Formatting.GOLD, Formatting.BOLD)
        val packetName = Text.literal("$packet.").formatted(Formatting.DARK_PURPLE)
        val metricName = Text.literal("$metric").formatted(Formatting.DARK_GREEN)
        val headerEnd = Text.literal("]: ").formatted(Formatting.GOLD, Formatting.BOLD)
        val message = Text.literal("Too much suspicious activity was generated from you.\nThis can be the result from using a hacked or 'utility' client. Verify your client's integrity and rejoin.")

        return Text.empty().append(headerStart).append(packetName).append(metricName).append(headerEnd).append(message)
    }
}